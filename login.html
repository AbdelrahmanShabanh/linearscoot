<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Liner Scoot</title>
    
    <link rel="stylesheet" href="scoot.css">
    <link rel="icon" type="image/x-icon" href="imgs/favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<style>
   html, body {
    height: 110%;
    margin: 0;
    padding: 0;
    overflow: hidden; 
} 
</style>
<body>
    <div class="container">
        <div class="forms-container">
            <div class="signin-signup">
             
                <form  class="sign-in-form" id="loginform" enctype="multipart/form-data" >
                     <!-- <img src="imgs/logosalem.jpg" class="logo" alt=""> -->
                    <h2 class="tittle">Sign in</h2>
                    <div class="input-field">
                        <i class="fas fa-user"></i>
                        <input type="email" placeholder="Email" id="name1" name="email" required>
                        <span id="name-error1" class="error-message">Name must be at least 3 characters long.</span>
                    </div>
                    <div class="input-field">
                        <i class="fas fa-lock" id="toggle-password1"></i>
                        <input type="password" placeholder="Password" id="password1" name="password" required>
                        <span id="password-error1" class="error-message">password must be at least 7 characters long.</span>
                    </div>
                    <a href="#" class="forgot-password">Forgot Password?</a>

                    <input type="submit" value="sign in" class="btn solid" >
                    <!-- <p class="social-text">Or Sign in with social platforms</p> -->
                    <!-- <div class="social-media">
                        <a href="#" class="social-icon">
                            <i class="fa-brands fa-facebook"></i>
                        </a>
                        <a href="#" class="social-icon">
                            <i class="fa-brands fa-google"></i>
                        </a>
                        <a href="#" class="social-icon">
                            <i class="fa-brands fa-x-twitter"></i>
                        </a>
                        <a href="#" class="social-icon">
                            <i class="fa-brands fa-linkedin-in"></i>
                        </a>
                    </div> -->
                </form>
                <form  class="sign-up-form" enctype="multipart/form-data" id="createacc" onsubmit="handleSignup(event)">
                    <!-- <img src="imgs/logo withoutbg.png" class="logo" alt=""> -->
                    <h2 class="tittle">Sign up</h2>
                    <div class="input-field">
                        <i class="fas fa-user"></i>
                        <input type="text" placeholder="Fullname" id="name" required name="fullname">
                        <span id="name-error" class="error-message">Name must be at least 3 characters long.</span>
                    </div>
                    <div class="input-field">
                        <i class="fa-solid fa-phone"></i>
                        <input type="number" placeholder="phone" id="phone"  required name="phoneNumber">
                        <span id="phone-error" class="error-message">phone must be 11 digits.</span>
                    </div>
                    <div class="input-field">
                        <i class="fas fa-envelope"></i>
                        <input type="text" placeholder="Email" id="email"  required name="email">
                        <span id="email-error" class="error-message">Please enter a valid email address.</span>
                    </div>
                    
                    <div class="input-field">
                        <i class="fas fa-lock" id="toggle-password"></i>
                        <input type="password" placeholder="Password" id="password"  required name="password">
                        <span id="password-error" class="error-message">password must be at least 7 characters long.</span>
                    </div>
                    <div class="input-field">
                        <i class="fas fa-venus-mars"></i>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="gender" value="male" required > Male
                            </label>
                            <label>
                                <input type="radio" name="gender" value="female" required> Female
                            </label>
                        </div>
                        <span id="gender-error" class="error-message">Please select your gender.</span>
                                   </div>
                                   <div class="input-fields-container">
                                    <div class="input-field" id="input-fields">
                                        <i class="fas fa-birthday-cake"></i>
                                        <input type="number" placeholder="Age" id="age" required name="age">
                                        <span id="age-error" class="error-message">Age must be at least 17.</span>
                                    </div>
                                    <div class="input-field" >
                                        <i class="fas fa-file-upload"></i>
                                        <label for="file" class="custom-file-upload">
                                            Your ID
                                        </label>
                                        <input type="file" id="file" name="id" accept="image/*" required>
                                        <span id="file-error" class="error-message">Please choose a file.</span>
                                    </div>
                                </div>
                    <div class="policy">
                        <input type="checkbox" required>
                        <h3>I accept all  <a href="terms and conditions.html">terms & condition</a></h3>
                      </div>
                     
                    <input type="submit" value="sign up" class="btn solid" >
                
                    <!-- <p class="social-text">Or Sign up with social platforms</p>
                    <div class="social-media">
                        <a href="#" class="social-icon">
                            <i class="fa-brands fa-facebook"></i>
                        </a>
                        <a href="#" class="social-icon">
                            <i class="fa-brands fa-google"></i>
                        </a>
                        <a href="#" class="social-icon">
                            <i class="fa-brands fa-x-twitter"></i>
                        </a>
                        <a href="#" class="social-icon">
                            <i class="fa-brands fa-linkedin-in"></i>
                        </a>
                    </div> -->
                </form>
            </div>
        </div>
        <div class="panels-container">
            <div class="panel left-panel">
                <div class="content">
                    <h3>New here ?</h3>
                    <p>Join us and be part of our linear scoot family!</p>
                    <button class="btn transparent" id="sign-up-btn">Sign up</button>

                </div>
                <img src="imgs/undraw_scooter_re_lrsb.svg" class="image" alt="">
            </div>
            <div class="panel right-panel">
                <div class="content">
                    <h3>One of us ?</h3>
                    <p>Sign in and enjoy our unique experience! </p>
                    <button class="btn transparent" id="sign-in-btn">Sign in</button>

                </div>
                <img src="imgs/undraw_map_re_60yf.svg" class="image" alt="">
            </div>
        </div>
    </div>
    <div class="loader">
        <video id="video" class="imgloader" autoplay muted  preload="auto">
            <source src="imgs/WhatsApp Video 2024-09-09 at 21.17.00_6ffabc2e.mp4" type="video/mp4">
        </video>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
    const container = document.querySelector('.container');

    function adjustForKeyboard() {
        if (window.innerHeight < window.outerHeight / 2) { // Detect if the keyboard is likely open
            container.style.position = 'relative';
            container.style.top = '0';
            container.style.height = '110vh';
        } else {
            container.style.position = 'fixed';
            container.style.top = 'auto';
            container.style.height = 'calc(var(--vh, 1vh) * 110)';
        }
    }

    window.addEventListener('resize', adjustForKeyboard);
    window.addEventListener('orientationchange', adjustForKeyboard);

    // Initial adjustment
    adjustForKeyboard();
});
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>;
    <script src="app.js"></script>
    <script>
    async function handleSignup(event) {
        event.preventDefault();
        
        // Get form data
        const form = document.getElementById('createacc');
        const formData = new FormData(form);
        
        // Validate required fields
        const requiredFields = ['fullname', 'email', 'phoneNumber', 'password', 'gender', 'age'];
        for (const field of requiredFields) {
            if (!formData.get(field)) {
                showNotification('error', 'Validation Error', `Please fill in your ${field}`);
                return;
            }
        }

        // Get the ID image file
        const idFile = document.getElementById('file').files[0];
        if (!idFile) {
            showNotification('error', 'Validation Error', 'Please upload your ID image');
            return;
        }

        // Validate file size (max 5MB)
        if (idFile.size > 5 * 1024 * 1024) {
            showNotification('error', 'Validation Error', 'ID image must be less than 5MB');
            return;
        }

        // Validate file type
        if (!idFile.type.startsWith('image/')) {
            showNotification('error', 'Validation Error', 'Please upload an image file');
            return;
        }

        // Convert image to base64
        const reader = new FileReader();
        reader.onload = async function(e) {
            const idImageBase64 = e.target.result;
            
            // Create user data object
            const userData = {
                fullname: formData.get('fullname'),
                email: formData.get('email'),
                phoneNumber: formData.get('phoneNumber'),
                password: formData.get('password'),
                gender: formData.get('gender'),
                age: formData.get('age'),
                idImage: idImageBase64,
                verificationStatus: 'pending'
            };

            try {
                // Show loading notification
                showNotification('info', 'Processing', 'Creating your account...');

                // Send data to server
                const response = await fetch('https://scooter-mocha.vercel.app/api/auth/signup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(userData)
                });

                const data = await response.json();

                if (response.ok) {
                    // Store pending verification data
                    localStorage.setItem('pendingVerification', JSON.stringify(userData));
                    
                    // Show success notification
                    showNotification('success', 'Account Created', 'Your account is pending verification. Please wait for admin approval.');
                    
                    // Redirect to login page after a short delay
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 2000);
                } else {
                    // Show error notification with server message
                    showNotification('error', 'Signup Failed', data.message || 'Failed to create account. Please try again.');
                }
            } catch (error) {
                console.error('Signup error:', error);
                showNotification('error', 'Error', 'An error occurred during signup. Please try again.');
            }
        };

        reader.onerror = function() {
            showNotification('error', 'Error', 'Failed to read the image file. Please try again.');
        };

        reader.readAsDataURL(idFile);
    }

    // Add notification system
    function showNotification(type, title, message) {
        const container = document.querySelector('.notification-container') || createNotificationContainer();
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        
        const icon = type === 'success' ? 'fa-check-circle' : 
                    type === 'error' ? 'fa-times-circle' : 
                    type === 'info' ? 'fa-info-circle' :
                    'fa-exclamation-circle';
        
        notification.innerHTML = `
            <i class="fas ${icon}"></i>
            <div class="notification-content">
                <div class="notification-title">${title}</div>
                <div class="notification-message">${message}</div>
            </div>
            <button class="notification-close" onclick="this.parentElement.remove()">
                <i class="fas fa-times"></i>
            </button>
        `;
        
        container.appendChild(notification);
        
        // Auto remove after 5 seconds
        setTimeout(() => {
            notification.style.animation = 'slideOut 0.3s ease-out forwards';
            setTimeout(() => notification.remove(), 300);
        }, 5000);
    }

    function createNotificationContainer() {
        const container = document.createElement('div');
        container.className = 'notification-container';
        document.body.appendChild(container);
        return container;
    }

    // Add notification styles
    const style = document.createElement('style');
    style.textContent = `
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        .notification {
            background: white;
            border-radius: 8px;
            padding: 16px 20px;
            margin-bottom: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            max-width: 400px;
            animation: slideIn 0.3s ease-out;
        }

        .notification.success {
            border-left: 4px solid #28a745;
        }

        .notification.error {
            border-left: 4px solid #dc3545;
        }

        .notification.info {
            border-left: 4px solid #17a2b8;
        }

        .notification.warning {
            border-left: 4px solid #ffc107;
        }

        .notification i {
            font-size: 20px;
        }

        .notification.success i {
            color: #28a745;
        }

        .notification.error i {
            color: #dc3545;
        }

        .notification.info i {
            color: #17a2b8;
        }

        .notification.warning i {
            color: #ffc107;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .notification-message {
            color: #666;
            font-size: 0.9rem;
        }

        .notification-close {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            padding: 4px;
            font-size: 18px;
        }

        .notification-close:hover {
            color: #666;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
    `;
    document.head.appendChild(style);
    </script>
    <script>
    document.getElementById('loginform').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const email = document.getElementById('name1').value;
        const password = document.getElementById('password1').value;

        try {
            // First check verification status
            const verificationResponse = await fetch('https://scooter-mocha.vercel.app/api/auth/check-verification', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ email })
            });

            const verificationData = await verificationResponse.json();

            if (verificationData.status === 'pending') {
                alert('Your account is still pending verification. Please wait for admin approval.');
                return;
            } else if (verificationData.status === 'rejected') {
                alert('Your ID verification was rejected. Please contact support for more information.');
                return;
            }

            // If verified, proceed with login
            const loginResponse = await fetch('https://scooter-mocha.vercel.app/api/auth/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ email, password })
            });

            if (loginResponse.ok) {
                const userData = await loginResponse.json();
                // Store user data and redirect
                localStorage.setItem('userData', JSON.stringify(userData));
                window.location.href = 'profile.html';
            } else {
                const error = await loginResponse.json();
                alert(error.message || 'Invalid email or password');
            }
        } catch (error) {
            console.error('Login error:', error);
            alert('An error occurred during login. Please try again.');
        }
    });
    </script>
</body>
</html>